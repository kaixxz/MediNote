import anthropic

client = anthropic.Anthropic(
    # defaults to os.environ.get("ANTHROPIC_API_KEY")
    api_key="my_api_key",
)

# Replace placeholders like {{PATIENT_INFO}} with real values,
# because the SDK does not support variables.
message = client.messages.create(
    model="claude-sonnet-4-20250514",
    max_tokens=20000,
    temperature=1,
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "<examples>\n<example>\n<PATIENT_INFO>\nPatient: Jane Doe, 45-year-old female\nChief Complaint: Persistent cough and fatigue for 2 weeks\n\nHistory of Present Illness:\n- Dry cough, worse at night\n- Fatigue and general malaise\n- No fever or chills\n- Mild shortness of breath with exertion\n- No chest pain\n\nPast Medical History:\n- Hypertension (diagnosed 5 years ago)\n- Seasonal allergies\n\nMedications:\n- Lisinopril 10mg daily\n- Loratadine 10mg daily as needed\n\nAllergies: Penicillin (rash)\n\nSocial History:\n- Non-smoker\n- Occasional alcohol use\n- Works as an office manager\n\nPhysical Examination:\n- Vital Signs: BP 128/82, HR 76, RR 18, Temp 37.0째C, SpO2 98% on room air\n- General: Alert, oriented, in no acute distress\n- HEENT: Oropharynx mildly erythematous, no exudates\n- Lungs: Scattered wheezes bilaterally, no crackles\n- Heart: Regular rate and rhythm, no murmurs\n- Abdomen: Soft, non-tender, non-distended\n\nRecent Test Results:\n- Chest X-ray: No acute cardiopulmonary process\n- CBC: WBC 7.2, Hgb 13.5, Plt 250\n- Basic Metabolic Panel: Within normal limits\n</PATIENT_INFO>\n<ideal_output>\n<soap_note>\nS:\n45-year-old female presents with 2-week history of persistent dry cough, worse at night, accompanied by fatigue and general malaise. Reports mild shortness of breath with exertion. Denies fever, chills, or chest pain. Past medical history significant for hypertension and seasonal allergies. Current medications include Lisinopril 10mg daily and Loratadine 10mg PRN. Penicillin allergy (rash). Non-smoker, occasional alcohol use.\n\nO:\nVital signs: BP 128/82, HR 76, RR 18, T 37.0째C, SpO2 98% on room air\nGeneral: Alert, oriented, no acute distress\nHEENT: Oropharynx mildly erythematous, no exudates\nLungs: Scattered wheezes bilaterally, no crackles\nHeart: Regular rate and rhythm, no murmurs\nAbdomen: Soft, non-tender, non-distended\nChest X-ray: No acute cardiopulmonary process\nCBC: WBC 7.2, Hgb 13.5, Plt 250\nBasic Metabolic Panel: Within normal limits\n\nA:\nSubacute bronchitis with bronchospasm, likely post-viral or allergic in etiology. Differential includes cough-variant asthma or allergic bronchitis. No evidence of pneumonia or acute cardiopulmonary pathology.\n\nP:\n1. Albuterol inhaler 2 puffs q4-6h PRN cough/wheezing\n2. Dextromethorphan 15mg q4h PRN cough\n3. Increase fluid intake and use humidifier\n4. Continue current medications\n5. Return if symptoms worsen or fever develops\n6. Follow-up in 1 week if no improvement\n7. Consider pulmonary function tests if symptoms persist beyond 4 weeks\n</soap_note>\n</ideal_output>\n</example>\n<example>\n<PATIENT_INFO>\nPatient: John Smith, 58-year-old male\nChief Complaint: Lower back pain and difficulty urinating for 3 days\n\nHistory of Present Illness:\n- Gradual onset of lower back pain, radiating to left leg\n- Increased frequency of urination with weak stream\n- No fever or chills\n- No recent trauma or heavy lifting\n\nPast Medical History:\n- Type 2 Diabetes (diagnosed 10 years ago)\n- Hyperlipidemia\n\nMedications:\n- Metformin 1000mg twice daily\n- Atorvastatin 20mg daily\n\nAllergies: None known\n\nSocial History:\n- Former smoker (quit 5 years ago)\n- Drinks 1-2 beers on weekends\n- Works as a bus driver\n\nPhysical Examination:\n- Vital Signs: BP 142/88, HR 82, RR 16, Temp 36.8째C, SpO2 97% on room air\n- General: Alert, oriented, mild discomfort\n- Back: Tenderness in lower lumbar region, limited range of motion\n- Neurological: Straight leg raise positive on left at 60 degrees\n- Abdomen: Soft, mild suprapubic tenderness, no costovertebral angle tenderness\n- Genitourinary: Normal external genitalia, enlarged prostate on digital rectal exam\n\nRecent Test Results:\n- Urinalysis: Trace leukocytes, negative for nitrites\n- Blood glucose: 142 mg/dL (fasting)\n- PSA: 4.8 ng/mL (elevated)\n</PATIENT_INFO>\n<ideal_output>\n<soap_note>\nS:\n58-year-old male presents with 3-day history of gradual onset lower back pain radiating to left leg, associated with urinary frequency and weak stream. Denies fever, chills, recent trauma, or heavy lifting. Past medical history significant for Type 2 diabetes (10 years) and hyperlipidemia. Current medications include metformin 1000mg BID and atorvastatin 20mg daily. Former smoker (quit 5 years ago), occasional alcohol use, works as bus driver.\n\nO:\nVital signs: BP 142/88, HR 82, RR 16, T 36.8째C, SpO2 97% RA\nGeneral: Alert, oriented, mild discomfort\nBack: Lower lumbar tenderness, limited ROM\nNeurological: Positive straight leg raise test at 60 degrees on left\nAbdomen: Soft, mild suprapubic tenderness, no CVAT\nGU: Normal external genitalia, enlarged prostate on DRE\nLabs: Urinalysis with trace leukocytes, nitrites negative; fasting glucose 142 mg/dL; PSA 4.8 ng/mL (elevated)\n\nA:\n1. Lumbar radiculopathy with left-sided sciatica\n2. Benign prostatic hyperplasia with urinary symptoms\n3. Elevated PSA requiring further evaluation\n4. Poorly controlled Type 2 diabetes mellitus\n5. Hypertension\n\nP:\n1. Lumbar spine MRI to evaluate radiculopathy\n2. NSAIDs for pain management, physical therapy referral\n3. Urology referral for elevated PSA and BPH evaluation\n4. Review diabetes management, consider medication adjustment\n5. Initiate antihypertensive therapy\n6. Follow-up in 2 weeks or sooner if symptoms worsen\n</soap_note>\n</ideal_output>\n</example>\n</examples>\n\n"
                },
                {
                    "type": "text",
                    "text": "You are a clinical documentation assistant for doctors. Your task is to generate concise, professional SOAP notes based on patient information provided. SOAP notes are a method of documentation employed by healthcare providers to write out notes in a patient's chart.\n\nFollow these guidelines to create a SOAP note:\n\n1. Subjective (S): Patient's chief complaint, symptoms, and relevant history as reported by the patient.\n2. Objective (O): Measurable and observable data, such as vital signs, physical exam findings, and test results.\n3. Assessment (A): Your analysis and interpretation of the Subjective and Objective information, including possible diagnoses.\n4. Plan (P): The treatment plan, including medications, further tests, referrals, and follow-up instructions.\n\nHere is the patient information:\n\n<patient_info>\n{{PATIENT_INFO}}\n</patient_info>\n\nCarefully analyze the patient information provided. Extract relevant details for each section of the SOAP note. Organize the information logically and concisely.\n\nFormat your SOAP note as follows:\n\nS:\n[Subjective information]\n\nO:\n[Objective information]\n\nA:\n[Assessment]\n\nP:\n[Plan]\n\nMaintain a professional, clinical tone throughout the note. Be concise and precise in your language, avoiding unnecessary details or repetition. Use medical terminology appropriately.\n\nYour final output should consist of only the formatted SOAP note, without any additional commentary or explanation. Present the SOAP note within <soap_note> tags."
                }
            ]
        }
    ]
)
print(message.content)